# Разработка Системы Управления Банковскими Картами

## Инструменты, необходимые для запуска проекта локально
1. Docker
2. PostgreSQL
3. Java
4. Maven

## Запустить проект можно 2 способами
### 1. Используя `docker-compose.yml`

Сначала необходимо выполнить команду `./mvnw package`.

В Docker открыть терминал, перейти в папку проекта `(bank_rest)`, где лежит файл `docker-compose.yml`
и выполнить команду `docker compose up -d`. Мы запустим наше приложение в контейнере и будет обращаться к БД, которая запущена в другом контейнере. В Dockerfile указан профиль для Spring, чтобы взять `application-docker.yml` для работы внутри контейнера.

### 2. Запуском приложения через IDEA

Для запуска сначала необходимо скачать docker-образ для базы данных `postgres:latest` и запустить его в контейнере командой:
```
docker run --name postgres \
-e POSTGRES_USER=user1 \
-e POSTGRES_PASSWORD=11111111 \
-e POSTGRES_DB=bank-rest \
-v pgdata:/var/lib/postgresql/data \
-p 5432:5432 \
-d postgres:latest
```

Логин, пароль, стандартная база должны совпадать с тем, что указано в `application.yml` проекта.

Далее для запуска необходимо найти класс с методом `main()`. Он находится по пути `src/main/java/com/example/bankcards/BankApplication`.

Для запуска проекта можно нажать зеленую стрелочку в файле `BankApplication`, либо выполнить команду в терминале в корне проекта `./mvnw spring-boot:run`

## Запуск тестов
Выполнить команду в корне проекта `./mvnw test`

## Проект запускается на порту `8090`
Для смены порта нужно изменить свойство `server.port` в `application.yml`.
Если проект запускается через Docker, то для смены порта нужно изменить порт в `Dockerfile` в строчке `EXPOSE`, а также поменять `docker-compose.yml`.

## Чтобы открыть Swagger
Нужно перейти по ссылке, когда проект запущен
http://localhost:8090/swagger-ui/index.html

## Стандартные креды для админа
В системе через Liquibase создается пользователь по-умолчанию:

```
email: admin
password: admin
```

## Как работает фильтрация и пагинация
Для перехода между страницами использются свойства `pageSize / pageNumber`, которые определяют номер и размер страницы, которую нужно начитать.
Для фильтрации используются следующие поля:
- `status` - статус карточки, равенство;
- `userId` - ID пользователя, равенство;
- `expiryDate` - срок истечения карточки, равенство;
- `balance` - баланс, фильтр "больше указанного баланса";
- `email` - email пользователя, равенство;
- `name` - имя пользователя, равенство;

## Дальнейшие шаги
В дальнейшем для развития проекта можно сделать следующее:
- Таблица `Transactions` для истории переводов средств;
- Вместо enum-классов для `Role / CardStatus` применить таблицы-словари, для возможности расширения;
- Точечная настройка `OpenApiConfig` для настройки авторизации;
- Фильтрации с условиями "больше, меньше, равно";
- Переводы по номеру карт между пользователями посредством работы с полем `encryptedNumber`;
